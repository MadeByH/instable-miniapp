<!doctype html>
<html lang="fa">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>پروفایل — اینستا بله</title>
<link rel="stylesheet" href="style.css">

<style>
  .profile-head{
    max-width:720px;
    margin:18px auto;
    padding:18px;
    background:var(--card);
    border-radius:14px;
    display:flex;
    gap:18px;
    align-items:center;
    box-shadow:0 4px 16px rgba(0,0,0,0.25);
  }
  .avatar{
    width:90px;height:90px;
    border-radius:50%;
    object-fit:cover;
    border:2.5px solid rgba(255,255,255,0.08);
  }
  .profile-meta{ flex:1; }
  .profile-meta h2{ margin:0;font-size:20px;color:#fff; }
  .profile-meta p{ margin:6px 0;color:#9eb0c8;line-height:1.5; }
  .stats{ display:flex;gap:18px;margin-top:10px;text-align:center; }
  .stats div{ font-size:14px;color:#d0e0f0; }
  .stats div strong{ font-size:17px;color:#fff; }
  .follow-btn{
    padding:9px 18px;
    border-radius:10px;
    background:var(--accent);
    font-size:14px;color:white;
    border:none;cursor:pointer;transition:0.25s;
  }
  .follow-btn:active{ transform:scale(0.94);}
  .unfollow-btn{
    background:transparent!important;
    border:1px solid rgba(255,255,255,0.15)!important;
  }
  .grid{
    display:grid;
    grid-template-columns:repeat(3,1fr);
    gap:4px;padding:8px;
  }
  .grid img{
    width:100%;height:100%;
    object-fit:cover;border-radius:6px;
  }
</style>

</head>
<body>
  <header class="topbar">
    <a href="index.html">← بازگشت</a><h1>پروفایل</h1>
  </header>

  <main>
    <div id="profile-root" style="max-width:720px;margin:12px auto"></div>
    <div id="profile-posts" class="grid" style="max-width:720px;margin:12px auto"></div>
    <div id="loading" class="loading">در حال بارگزاری...</div>
  </main>

<script src="https://tapi.bale.ai/miniapp.js?3"></script>
<script>
  if (window.Bale && window.Bale.WebApp) {
    Bale.WebApp.ready();
  }
</script>

<script src="app.js"></script>
<script>
  window.API_BASE = "https://insta-api-avn2.onrender.com/api";
  
  // -----------------------------------------------------------------
  // اصلاح منطق دسترسی به DOM برای تابع اصلی
  // -----------------------------------------------------------------
  setTimeout(() => {
  window.renderProfileFromQuery();
}, 0);
</script>

<!-- این باید بیرون از Script باشد -->
<div id="nav"></div>

<script>
fetch("nav.html")
  .then(r => r.text())
  .then(html => {
    const navContainer = document.getElementById("nav");
    navContainer.innerHTML = html;

    // ----------------------------------------------------
    //  حذف منطق Fallback تست (uid = 1)
    // ----------------------------------------------------
    let uid;
    try {
      // استفاده از تابع جدیدی که شما پیشنهاد دادید
      uid = getUserId(); 
    } catch (e) {
      console.error("Error getting user ID:", e);
    }

    const profileLink = document.getElementById("profile-link");

    if(uid){
      // اطمینان از وجود لینک قبل از تغییر href
      if(profileLink) {
        profileLink.href = `profile.html?user_id=${uid}`;
      }
    } else {
      // اگر uid پیدا نشد یا خطا رخ داد
      if(profileLink) {
        profileLink.onclick = () => alert("شناسه کاربر یافت نشد");
      }
    }
  });
</script>

</body>
</html>
