<!doctype html>
<html lang="fa">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Debug Bale MiniApp</title>
  <style>
    body{
      background:#0b1220;
      color:#e6eef8;
      font-family:system-ui;
      padding:16px;
      line-height:1.7;
    }
    h2{margin-top:24px}
    pre{
      background:#05060a;
      padding:12px;
      border-radius:8px;
      overflow:auto;
      font-size:13px;
    }
    .ok{color:#4ade80}
    .err{color:#f87171}
    .warn{color:#facc15}
  </style>
</head>
<body>

<h1>ğŸ” ØªØ³Øª Ù…ÛŒÙ†ÛŒâ€ŒØ§Ù¾ Ø¨Ù„Ù‡</h1>

<div id="status">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ø±Ø³ÛŒâ€¦</div>

<h2>ÙˆØ¶Ø¹ÛŒØª WebApp</h2>
<pre id="webapp"></pre>

<h2>initDataUnsafe (Ø®Ø§Ù…)</h2>
<pre id="initdata"></pre>

<h2>Ù†ØªÛŒØ¬Ù‡</h2>
<pre id="result"></pre>

<script src="https://tapi.bale.ai/miniapp.js?3"></script>

<script>
const statusEl   = document.getElementById("status");
const webappEl  = document.getElementById("webapp");
const initEl    = document.getElementById("initdata");
const resultEl  = document.getElementById("result");

function print(el, obj){
  el.textContent = typeof obj === "string"
    ? obj
    : JSON.stringify(obj, null, 2);
}

function fail(msg){
  statusEl.innerHTML = "âŒ <span class='err'>" + msg + "</span>";
  print(resultEl, msg);
}

try {
  // 1ï¸âƒ£ Ø¢ÛŒØ§ Ø¯Ø§Ø®Ù„ Ø¨Ù„Ù‡ Ù‡Ø³ØªÛŒÙ…ØŸ
  if (!window.Bale || !Bale.WebApp) {
    fail("Bale.WebApp ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯ â†’ Ø§ÛŒÙ† ØµÙØ­Ù‡ Ø¯Ø§Ø®Ù„ Ø§Ù¾ Ø¨Ù„Ù‡ Ø¨Ø§Ø² Ù†Ø´Ø¯Ù‡");
    print(webappEl, "undefined");
    return;
  }

  statusEl.innerHTML = "âœ… <span class='ok'>Bale.WebApp Ù…ÙˆØ¬ÙˆØ¯ Ø§Ø³Øª</span>";
  print(webappEl, Object.keys(Bale.WebApp));

  // 2ï¸âƒ£ Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ
  Bale.WebApp.ready();

  // 3ï¸âƒ£ Ø®ÙˆØ§Ù†Ø¯Ù† initDataUnsafe
  const data = Bale.WebApp.initDataUnsafe || {};
  print(initEl, data);

  if (!data.user) {
    fail("initDataUnsafe.user ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯ â†’ Ù…ÛŒÙ†ÛŒâ€ŒØ§Ù¾ Ø¨Ø§ launch context Ø§Ø¬Ø±Ø§ Ù†Ø´Ø¯Ù‡");
    return;
  }

  if (!data.user.id) {
    fail("user ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯ ÙˆÙ„ÛŒ user.id Ø§Ø±Ø³Ø§Ù„ Ù†Ø´Ø¯Ù‡");
    return;
  }

  // 4ï¸âƒ£ Ù…ÙˆÙÙ‚ ğŸ‰
  statusEl.innerHTML = "ğŸ‰ <span class='ok'>Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø± Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯</span>";

  print(resultEl, {
    user_id: data.user.id,
    username: data.user.username,
    first_name: data.user.first_name,
    last_name: data.user.last_name,
    photo_url: data.user.photo_url
  });

} catch (e) {
  fail("Ø®Ø·Ø§ÛŒ Ø¬Ø§ÙˆØ§Ø§Ø³Ú©Ø±ÛŒÙ¾Øª: " + e.message);
}
</script>

</body>
</html>
