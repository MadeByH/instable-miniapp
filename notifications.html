<!doctype html>
<html lang="fa">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>اعلان‌ها</title>
<link rel="stylesheet" href="style.css">

<style>
.notif{
  padding:14px;
  border-bottom:1px solid rgba(255,255,255,.06);
}
.notif-time{
  font-size:12px;
  color:#8aa0b8;
  margin-top:4px;
}
</style>
</head>

<body>

<header class="topbar">
  <h1>اعلان‌ها</h1>
</header>

<main id="notifRoot"></main>
<div id="loading" class="loading">در حال بارگذاری…</div>
<div id="nav"></div>

<script>
window.API_BASE = "https://insta-api-avn2.onrender.com/api";
</script>

<script>
function safeStart(fn) {
  let started = false;

  function start() {
    if (started) return;
    started = true;
    fn();
  }

  // تلاش اول
  setTimeout(start, 200);

  // تلاش دوم (برای WebView بله)
  setTimeout(start, 800);

  // تلاش سوم (برای گوشی‌های ضعیف‌تر)
  setTimeout(start, 1500);
}
</script>

<script>
async function loadNotifications(){
  const root = document.getElementById("notifRoot");
  const loading = document.getElementById("loading");

  try {
    const res = await fetch(`${API_BASE}/notifications/1`);
    const data = await res.json();

    loading.style.display = "none";

    if(!Array.isArray(data) || data.length === 0){
      root.innerHTML = "<p style='text-align:center'>اعلانی وجود ندارد</p>";
      return;
    }

    data.forEach(n => {
      const div = document.createElement("div");
      div.className = "notif";
      div.innerHTML = `
        <div>${n.text}</div>
        <div class="notif-time">${n.created_at}</div>
      `;
      root.appendChild(div);
    });

  } catch (e){
    loading.textContent = "خطا در دریافت اعلان‌ها";
  }
}

<script>
safeStart(loadNotifications);
</script>

fetch("nav.html")
  .then(r => r.text())
  .then(html => document.getElementById("nav").innerHTML = html);
</script>

</body>
</html>
