<!doctype html>
<html lang="fa">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>اعلان‌ها</title>
<link rel="stylesheet" href="style.css">
</head>

<body>

<header class="topbar">
  <h1>اعلان‌ها</h1>
</header>

<main id="notifRoot"></main>
<div id="loading" class="loading">در حال بارگذاری…</div>

<div id="nav"></div>

<script src="auth.js"></script>
<script>
const API_BASE = "https://insta-api-avn2.onrender.com/api";

async function loadNotifications(){
  const root = document.getElementById("notifRoot");
  const loading = document.getElementById("loading");

  try{
    const me = requireAuth();

    const res = await fetch(`${API_BASE}/notifications/${me.id}`);
    const data = await res.json();

    loading.style.display = "none";

    if (!Array.isArray(data) || data.length === 0){
      // 1. المان اصلی محتوا (root) را برای وسط‌چین شدن تنظیم می‌کنیم
      root.style.display = "flex";
      root.style.flexDirection = "column";
      root.style.alignItems = "center"; // وسط‌چین افقی
      root.style.justifyContent = "center"; // وسط‌چین عمودی
      
      // 2. برای اطمینان از وسط‌چین عمودی، به root ارتفاع می‌دهیم.
      // این ارتفاع باید به اندازه‌ای باشد که فضای خالی بین نوار بالا و نوار پایین را پر کند.
      // ما از 80vh استفاده می‌کنیم (80% از ارتفاع ویوپورت) تا فضای کافی برای مرکزیت داشته باشد.
      root.style.height = "80vh"; 
      root.style.width = "100%"; // اطمینان از عرض کامل

      root.innerHTML = `<p class="center-msg">اعلانی وجود ندارد</p>`;
      return;
    }

    data.forEach(n=>{
      const div = document.createElement("div");
      div.className = "notif";
      div.innerHTML = `
        <div>${n.text}</div>
        <div class="notif-time">${n.created_at}</div>
      `;
      root.appendChild(div);
    });

  }catch(e){
    loading.style.display = "none";
    root.innerHTML = `<p class="center-msg">خطا در دریافت اعلان‌ها</p>`;
  }
}

loadNotifications();
</script>

<script>
fetch("nav.html")
  .then(r=>r.text())
  .then(html=>nav.innerHTML=html);
</script>

</body>
</html>
