<script src="https://tapi.bale.ai/miniapp.js?3"></script>
<script src="app.js"></script>
<script>
window.API_BASE = "https://insta-api-avn2.onrender.com/api";

(async () => {
  const root = document.getElementById("notifRoot");
  const loading = document.getElementById("loading");

  let uid;
  try {
    uid = getUserId();
  } catch {
    loading.textContent = "اعلان‌ها فقط داخل بله قابل مشاهده‌اند";
    return;
  }

  try {
    const data = await apiGet(`/notifications/${uid}`);
    loading.style.display = "none";

    if (!data.length) {
      root.innerHTML = "اعلانی وجود ندارد";
      return;
    }

    data.forEach(n => {
      const div = document.createElement("div");
      div.className = "notif" + (n.is_read ? "" : " unread");
      div.innerHTML = `<div>${n.text}</div>`;
      root.appendChild(div);
    });
  } catch {
    loading.textContent = "خطا در دریافت اعلان‌ها";
  }
})();
</script>
